<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FactCheck Panel</title>
    <style>
      :root {
        /* Colors - Light Mode */
        --bg: #ffffff;
        --bg-secondary: #f8f9fa;
        --fg: #1a1a1a;
        --fg-secondary: #6b7280;
        --muted: #9ca3af;
        --border: #e5e7eb;
        --accent: #3b82f6;
        --accent-light: #eff6ff;
        --good: #059669;
        --good-light: #ecfdf5;
        --warn: #d97706;
        --warn-light: #fffbeb;
        --bad: #dc2626;
        --bad-light: #fef2f2;
        --link: #3b82f6;
        --link-hover: #1d4ed8;

        /* Spacing */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.5rem;
        --space-6: 2rem;

        /* Radii */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;

        /* Typography */
        --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        --font-size-xs: 0.75rem;
        --font-size-sm: 0.875rem;
        --font-size-base: 1rem;
        --font-size-lg: 1.125rem;
        --line-height-tight: 1.25;
        --line-height-normal: 1.5;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #111827;
          --bg-secondary: #1f2937;
          --fg: #f9fafb;
          --fg-secondary: #d1d5db;
          --muted: #6b7280;
          --border: #374151;
          --accent: #60a5fa;
          --accent-light: #1e3a8a;
          --good: #34d399;
          --good-light: #064e3b;
          --warn: #fbbf24;
          --warn-light: #78350f;
          --bad: #f87171;
          --bad-light: #7f1d1d;
          --link: #60a5fa;
          --link-hover: #93c5fd;
        }
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-sans);
        font-size: var(--font-size-sm);
        line-height: var(--line-height-normal);
        color: var(--fg);
        background: var(--bg);
        overflow-x: hidden;
      }

      #sp-root {
        width: 100%;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Header */
      #sp-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-4);
        border-bottom: 1px solid var(--border);
        background: var(--bg);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .app-title {
        font-weight: 600;
        font-size: var(--font-size-base);
        color: var(--fg);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--good);
      }

      .close-btn {
        background: none;
        border: none;
        padding: var(--space-1);
        border-radius: var(--radius-sm);
        cursor: pointer;
        color: var(--fg-secondary);
        transition: background-color 0.15s ease;
      }

      .close-btn:hover {
        background: var(--bg-secondary);
      }

      .close-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      /* Main Content */
      .content {
        flex: 1;
        padding: var(--space-4);
        display: flex;
        flex-direction: column;
        gap: var(--space-5);
      }

      /* Selection Preview */
      #sp-selection {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: var(--space-4);
      }

      .selection-content {
        color: var(--fg-secondary);
        font-size: var(--font-size-sm);
        line-height: var(--line-height-normal);
      }

      .selection-content.collapsed {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .toggle-btn {
        background: none;
        border: none;
        color: var(--link);
        cursor: pointer;
        font-size: var(--font-size-sm);
        padding: 0;
        text-decoration: underline;
      }

      .toggle-btn:hover {
        color: var(--link-hover);
      }

      .toggle-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
        border-radius: var(--radius-sm);
      }

      /* Classification */
      #sp-classification {
        text-align: center;
      }

      .classification-badge {
        display: inline-flex;
        align-items: center;
        padding: var(--space-3) var(--space-5);
        border-radius: var(--radius-lg);
        font-weight: 600;
        font-size: var(--font-size-base);
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .classification-badge[data-type="opinion"] {
        background: var(--accent-light);
        color: var(--accent);
        border: 1px solid var(--accent);
      }

      .classification-badge[data-type="statement"] {
        background: var(--accent-light);
        color: var(--accent);
        border: 1px solid var(--accent);
      }

      /* Categories */
      #sp-categories {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
        margin-bottom: var(--space-4);
      }

      .chip {
        display: inline-flex;
        align-items: center;
        padding: var(--space-1) var(--space-3);
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        font-size: var(--font-size-xs);
        color: var(--fg-secondary);
        font-weight: 500;
      }

      /* Credibility */
      #sp-credibility {
        padding: var(--space-4);
        border-radius: var(--radius-md);
        border: 1px solid;
      }

      #sp-credibility[data-level="high"] {
        background: var(--good-light);
        border-color: var(--good);
        color: var(--good);
      }

      #sp-credibility[data-level="medium"] {
        background: var(--warn-light);
        border-color: var(--warn);
        color: var(--warn);
      }

      #sp-credibility[data-level="low"] {
        background: var(--bad-light);
        border-color: var(--bad);
        color: var(--bad);
      }

      .credibility-level {
        font-weight: 600;
        font-size: var(--font-size-sm);
        margin-bottom: var(--space-1);
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .credibility-rationale {
        font-size: var(--font-size-sm);
        opacity: 0.9;
      }

      /* Sources */
      #sp-sources {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
      }

      .section-title {
        font-weight: 600;
        color: var(--fg);
        margin-bottom: var(--space-3);
      }

      .source-card {
        display: block;
        text-decoration: none;
        padding: var(--space-4);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        background: var(--bg);
        transition: all 0.15s ease;
        color: inherit;
      }

      .source-card:hover {
        border-color: var(--accent);
        background: var(--bg-secondary);
      }

      .source-card:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      .source-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: var(--space-2);
        margin-bottom: var(--space-2);
      }

      .source-title {
        font-weight: 600;
        font-size: var(--font-size-sm);
        color: var(--fg);
        line-height: var(--line-height-tight);
      }

      .external-icon {
        flex-shrink: 0;
        color: var(--muted);
        margin-top: var(--space-1);
      }

      .source-domain {
        font-size: var(--font-size-xs);
        color: var(--muted);
        margin-bottom: var(--space-2);
      }

      .source-snippet {
        font-size: var(--font-size-sm);
        color: var(--fg-secondary);
        line-height: var(--line-height-normal);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Footer */
      #sp-footer {
        padding: var(--space-4);
        border-top: 1px solid var(--border);
        background: var(--bg);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--space-3);
      }

      .footer-actions {
        display: flex;
        gap: var(--space-2);
      }

      .action-btn {
        display: flex;
        align-items: center;
        gap: var(--space-1);
        padding: var(--space-2) var(--space-3);
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-xs);
        color: var(--fg-secondary);
        cursor: pointer;
        transition: all 0.15s ease;
        text-decoration: none;
      }

      .action-btn:hover {
        background: var(--accent-light);
        border-color: var(--accent);
        color: var(--accent);
      }

      .action-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      .settings-btn {
        background: none;
        border: none;
        padding: var(--space-2);
        border-radius: var(--radius-sm);
        cursor: pointer;
        color: var(--fg-secondary);
        transition: background-color 0.15s ease;
      }

      .settings-btn:hover {
        background: var(--bg-secondary);
      }

      .settings-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      /* Loading States */
      #sp-root[data-state="loading"] .skeleton {
        background: linear-gradient(
          90deg,
          var(--bg-secondary) 25%,
          var(--border) 50%,
          var(--bg-secondary) 75%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
        border-radius: var(--radius-sm);
      }

      @keyframes skeleton-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      .skeleton-badge {
        height: 40px;
        width: 120px;
        margin: 0 auto;
      }

      .skeleton-chip {
        height: 24px;
        width: 80px;
      }

      .skeleton-source {
        height: 100px;
        width: 100%;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: var(--space-6);
        color: var(--fg-secondary);
      }

      .empty-state h3 {
        margin: 0 0 var(--space-2) 0;
        color: var(--fg);
      }

      .retry-btn {
        margin-top: var(--space-3);
        color: var(--link);
        background: none;
        border: none;
        cursor: pointer;
        text-decoration: underline;
      }

      .retry-btn:hover {
        color: var(--link-hover);
      }

      /* Error State */
      .error-alert {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-3);
        background: var(--bad-light);
        border: 1px solid var(--bad);
        border-radius: var(--radius-md);
        color: var(--bad);
        font-size: var(--font-size-sm);
      }

      /* Responsive adjustments */
      @media (max-width: 360px) {
        .content {
          padding: var(--space-3);
          gap: var(--space-4);
        }

        #sp-header {
          padding: var(--space-3);
        }

        #sp-footer {
          padding: var(--space-3);
          flex-direction: column;
          gap: var(--space-2);
        }

        .footer-actions {
          width: 100%;
          justify-content: center;
        }
      }

      /* Reduced motion */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Hide elements based on state */
      #sp-root[data-state="loading"] .ready-content {
        display: none;
      }
      #sp-root[data-state="ready"] .loading-content {
        display: none;
      }
      #sp-root[data-state="ready"] .empty-content {
        display: none;
      }
      #sp-root[data-state="ready"] .error-content {
        display: none;
      }
      #sp-root[data-state="empty"] .ready-content {
        display: none;
      }
      #sp-root[data-state="empty"] .loading-content {
        display: none;
      }
      #sp-root[data-state="empty"] .error-content {
        display: none;
      }
      #sp-root[data-state="error"] .ready-content {
        display: none;
      }
      #sp-root[data-state="error"] .loading-content {
        display: none;
      }
      #sp-root[data-state="error"] .empty-content {
        display: none;
      }

      /* Hide/show content based on analysis type */
      #sp-root[data-analysis-type="text"] #sp-image-preview {
        display: none;
      }
      #sp-root[data-analysis-type="image"] #sp-selection {
        display: none;
      }
      #sp-root[data-analysis-type="image"] #sp-image-preview {
        display: block;
      }

      /* Hide credibility for opinion */
      #sp-root[data-classification="opinion"] #sp-credibility {
        display: none;
      }

      /* Image Preview Styles */
      #sp-image-preview {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: var(--space-4);
      }

      .image-preview-container {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
      }

      .image-info {
        display: flex;
        flex-direction: column;
        gap: var(--space-1);
      }

      .image-filename {
        font-weight: 600;
        color: var(--fg);
        font-size: var(--font-size-sm);
      }

      .image-status {
        font-size: var(--font-size-xs);
        color: var(--fg-secondary);
      }

      /* Image Analysis Results */
      #sp-image-labels {
        margin-top: var(--space-4);
      }

      .label-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-2) 0;
        border-bottom: 1px solid var(--border);
      }

      .label-item:last-child {
        border-bottom: none;
      }

      .label-name {
        font-size: var(--font-size-sm);
        color: var(--fg);
      }

      .label-confidence {
        font-size: var(--font-size-xs);
        color: var(--fg-secondary);
        background: var(--bg-secondary);
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-sm);
      }

      #sp-ocr-text {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: var(--space-4);
        margin-top: var(--space-4);
      }

      .ocr-content {
        font-style: italic;
        color: var(--fg-secondary);
        border-left: 3px solid var(--accent);
        padding-left: var(--space-3);
      }
    </style>
  </head>
  <body>
    <div id="sp-root" data-state="empty" data-classification="statement">
      <!-- Header -->
      <header id="sp-header">
        <div class="header-left">
          <h1 class="app-title">NewsOwl</h1>
          <div class="status-dot" title="Connected"></div>
        </div>

        <!-- Classification -->
        <section id="sp-classification">
          <div class="classification-badge" data-type="statement">
            Statement
          </div>
          <!-- For Opinion: <div class="classification-badge" data-type="opinion">Opinion</div> -->
        </section>
      </header>

      <!-- Main Content -->
      <main class="content">
        <!-- Selection Preview -->
        <section id="sp-selection">
          <div class="selection-content collapsed" id="selection-text">
            Select text on any webpage to analyze it for fact-checking.
          </div>
        </section>

        <!-- Image Preview (hidden by default) -->
        <section id="sp-image-preview" style="display: none">
          <div class="image-preview-container">
            <img
              id="preview-image"
              src=""
              alt="Analyzing image"
              style="
                max-width: 100%;
                height: auto;
                border-radius: var(--radius-md);
                border: 1px solid var(--border);
              "
            />
            <div class="image-info">
              <div class="image-filename" id="image-filename">
                Image Analysis
              </div>
              <div class="image-status" id="image-status">
                Analyzing content...
              </div>
            </div>
          </div>
        </section>

        <!-- Loading Content -->
        <div class="loading-content">
          <div id="sp-classification">
            <div class="skeleton skeleton-badge"></div>
          </div>

          <div id="sp-categories">
            <div class="skeleton skeleton-chip"></div>
            <div class="skeleton skeleton-chip"></div>
            <div class="skeleton skeleton-chip"></div>
          </div>

          <div id="sp-sources">
            <h2 class="section-title">Related Sources</h2>
            <div class="skeleton skeleton-source"></div>
            <div class="skeleton skeleton-source"></div>
            <div class="skeleton skeleton-source"></div>
          </div>
        </div>

        <!-- Ready Content -->
        <div class="ready-content">
          <!-- Categories -->
          <section id="sp-categories">
            <span class="chip">General</span>
          </section>

          <!-- Credibility (only for statements) -->
          <section id="sp-credibility" data-level="medium">
            <div class="credibility-level">Medium Credibility</div>
            <div class="credibility-rationale">Based on available sources</div>
          </section>

          <!-- Image Labels (only for image analysis) -->
          <section id="sp-image-labels" style="display: none">
            <h2 class="section-title">Detected Content</h2>
            <div class="labels-list"></div>
          </section>

          <!-- Related Sources -->
          <section id="sp-sources">
            <h2 class="section-title">Related Sources</h2>
            <a
              href="https://www.thevibes.com/articles/news/112938/tiger-carcass-was-for-black-market-expected-to-fetch-up-to-rm300k"
              class="source-card"
              target="_blank"
              rel="noopener"
            >
              <div class="source-header">
                <h3 class="source-title">
                  Tiger carcass was for black market, expected to fetch up to
                  RM300k
                </h3>
                <svg
                  class="external-icon"
                  width="12"
                  height="12"
                  viewBox="0 0 12 12"
                  fill="currentColor"
                >
                  <path
                    d="M3.5 3c-.28 0-.5.22-.5.5s.22.5.5.5h3.086L2.793 7.793a.5.5 0 1 0 .707.707L7.293 4.707V7.5a.5.5 0 0 0 1 0v-4a.5.5 0 0 0-.5-.5h-4z"
                  />
                </svg>
              </div>
              <div class="source-domain">the Vibes.com</div>
              <p class="source-snippet">
                THE carcass of a tiger found dead in a car with three
                individuals in Felda Tenggaroh, Mersing in Johor is believed to
                be for sale on the black market.
              </p>
            </a>
            <a
              href="https://www.straitstimes.com/asia/se-asia/tiger-carcass-in-car-boot-sparks-outrage-in-malaysia"
              class="source-card"
              target="_blank"
              rel="noopener"
            >
              <div class="source-header">
                <h3 class="source-title">
                  Tiger carcass in car boot sparks outrage in Malaysia
                </h3>
                <svg
                  class="external-icon"
                  width="12"
                  height="12"
                  viewBox="0 0 12 12"
                  fill="currentColor"
                >
                  <path
                    d="M3.5 3c-.28 0-.5.22-.5.5s.22.5.5.5h3.086L2.793 7.793a.5.5 0 1 0 .707.707L7.293 4.707V7.5a.5.5 0 0 0 1 0v-4a.5.5 0 0 0-.5-.5h-4z"
                  />
                </svg>
              </div>
              <div class="source-domain">The StraitsTimes</div>
              <p class="source-snippet">
                KUALA LUMPUR â€“ Malaysian wildlife and political groups reacted
                with outrage on Sept 18 after the carcass of a critically
                endangered Malayan tiger was discovered in the back of a car,
                leading to the arrest of three suspects.
              </p>
            </a>
          </section>
        </div>

        <!-- Empty State -->
        <div class="empty-content">
          <div class="empty-state">
            <h3>No related sources found</h3>
            <p>We couldn't find any relevant sources for this selection.</p>
            <button class="retry-btn" type="button" onclick="retry()">
              Retry
            </button>
          </div>
        </div>

        <!-- Error State -->
        <div class="error-content">
          <div class="error-alert">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path
                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
              />
              <path
                d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"
              />
            </svg>
            <span>Failed to analyze selection. Please try again.</span>
            <button class="retry-btn" type="button" onclick="retry()">
              Retry
            </button>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer id="sp-footer">
        <div class="footer-actions">
          <button class="action-btn" type="button">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path
                d="M4 1.5H3a2 2 0 0 0-2 2V9a2 2 0 0 0 2 2h3.5a2 2 0 0 0 2-2V8.5a.5.5 0 0 0-1 0V9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1a.5.5 0 0 0 0-1z"
              />
              <path
                d="M8.5 1a.5.5 0 0 0-.5.5v1.293L6.146 4.646a.5.5 0 1 0 .708.708L8.707 3.5H10a.5.5 0 0 0 0-1H8.5z"
              />
            </svg>
            Copy
          </button>
          <button class="action-btn" type="button">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path
                d="M6 1a.5.5 0 0 1 .5.5V5h3a.5.5 0 0 1 0 1H6.5v3.5a.5.5 0 0 1-1 0V6H2a.5.5 0 0 1 0-1h3.5V1.5A.5.5 0 0 1 6 1z"
              />
            </svg>
            Save
          </button>
        </div>
        <button
          class="settings-btn"
          type="button"
          aria-label="Settings"
          title="Settings"
        >
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"
            />
          </svg>
        </button>
      </footer>
    </div>
    <script src="sidepanel.js"></script>
  </body>
</html>
